Database Janitor
---

Highly-configurable database dumper

## Features

 - Configuration-first
 - PHP with minimal dependencies

## Usage

This application can either be used as a CLI app or a library that other applications can build on top of, e.g a drush
command or another custom application.

### Testing

There is a sample Lando config you can use to spin up two separate mysql databases for testing, as well as a sample SQL
file containing random data generated by [Mockaroo](https://mockaroo.com/).

```bash
lando start
lando db-import sampledata.sql --host real_database
```

### Configuration

```yaml
sanitize_tables:
  # List of tables and their columns you want sanitized.
  user:
  - mail
trim_tables:
# List of tables to be trimmed (every 4th row kept)
  - trim1
excluded_tables:
# Tables to NOT dump
  - exclude1
scrub_tables:
# Tables to dump sans content.
  - scrub1
keep_rows:
  # Specific rows from tables to keep, by primary ID.
  table:
    - 1
```

### CLI

First you'll want to copy `.janitor.example.yml` to `.janitor.yml`. You can then go in and edit exactly which tables and
columns you want sanitized/ignored/cleared.

Then install dependencies with `composer install`.

#### Dumping

This will prompt you for the database password, then produce a gzip'd .sql file in the `output/` directory.

By default Janitor output to STDOUT for piping.

```bash
./database-janitor --host=localhost:8787 --username=real real | gzip -c > output/real_test.sql.gz
```

#### Trimming

Trimming allows much smaller database dumps by reducing the data exported. It does so by only keeping every fourth row,
and allows you to completely scrub tables (e.g caches) to further reduce the size. Is as non destructive as possible - it first renames the original database, copies the contents to a dummy database, dumps, then deletes the dummy database and renames the original back.

```bash
./database-janitor --host=localhost:8787 --username=real --trim=true real | gzip -c > output/real_test.sql.gz
```
